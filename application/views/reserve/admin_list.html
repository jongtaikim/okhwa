<style type="text/css" title="">
    .start{ height:30px; padding:10px 0 0 0; overflow:hidden;}
    .start .icon{ float:left}
    .start .icon ul{}
    .start .icon ul li{ float:left; padding-right:10px;}
    .start .button{ float:right;}
    .start .button button{height:32px; width:100px; color:#fff; background-color:#333; border:0; cursor:pointer; padding-bottom:5px;}
    .calendar{}
    .calendar .month{ text-align:center; font-size:1.3em; height:20px; padding-bottom:10px;}
    .calendar .month img{ padding:0 6px 0 6px;}
    .calendar .caltable{}
    .calendar .caltable .finish{ color:#a16e6e; font-weight:bold;}
    .calendar .caltable .wait{color:#6e8aa1; font-weight:bold;}


    .calendar .caltable table{}
    .calendar .caltable table .sun{background-color:#a16e6e}
    .calendar .caltable table .sat{background-color:#6e8aa1}
    .calendar .caltable table th{ background-color:#888; color:#fff; border-right:1px solid #fff; border-bottom:1px solid #fff;height:40px; font-size:1.1em; }
    .calendar .caltable table td{  border-right:1px solid #eee; border-bottom:1px solid #eee; height:180px; text-align:center; position:relative;}
    .calendar .caltable table td .day{  position:absolute;left:10px;top:10px}
    /*.calendar .caltable table td .day{ position:absolute; top:6px; left:6px; color:#999;}*/
    .calendar .caltable button{ background-color:#fff; border:1px solid #ccc; color:#999; padding:4px; width:80px; margin-top:5px; cursor:pointer}
</style>
<div class="card table-responsive">

    <div class="card-heading bg-light lt  pos_r">

    <strong class="h4">  예약현황</strong>
        <small class="">
            예약현황을 관리합니다.
        </small>
    </div>
    <div class="card-body b-t calendar">

        <div class="caltable text-center " style="zoom:1.2">
            <form id="FrmAttendanceSearchs"  onsubmit='return false;'>
                <input type="hidden" name="mode" value="next"/>

                <input type="hidden" name="day" id="leavedate" value="<?=date('Y-m-d')?>"   />

                <input type="hidden" name="str_year" id="str_year" value="<?=date('Y')?>" />
                <input type="hidden" name="str_month" id="str_month" value="<?=date('m')?>" />
                <input type="hidden" name="str_day" id="str_day" value="<?=date('d')?>" />

                <div class="month padding clearfix">
                    <img src="/images/prev.jpg" onclick="InoutInList.leftdates()" style="cursor:pointer;" >
                    <span id="temp_year"><?=date('Y')?></span>.<span id="temp_month"><?=date('m')?></span>
                    <img src="/images/next.jpg" onclick="InoutInList.rightdates()" style="cursor:pointer;">
                </div>
            </form>
            <br>

        </div>

        <div class="p-b20 p-t10">
            <span class="label blue">대</span> 입금대기 , <span class="label red">완</span> 입금완료
        </div>
    <div class="caltable  ">
            {caltemp}
        </div>
    </div>

</div>

<style type="text/css" title="">
.cumr tbody tr td{padding:15px}
</style>
<script type="text/javascript">
var jsondata ='';
function view_reserve(no,pay_state) {
//encodeURIComponent()
$.ajax({
type: 'GET',
url: '/admin/realpans/data_json?no='+no,
data:'',
dataType: 'json',
	success: function(data, status) {
        console.log(data);
        json = data.result;
        var html = '<div>';

        html +='<table align="center" width="100%" border="0" cellspacing="0" cellpadding="0" class="table table-bordered cumr" style="font-size:12px">';
        html +='<tbody>';
        html +='<tr><th class="w130 light dker text-center " >예약자</th><td class="padding">'+json.name+'</td></tr>';
        html +='<tr><th class="w130 light dker text-center">예약일시</th><td>'+json.created+'</td></tr>';
        html +='<tr><th class="w130 light dker text-center">날짜</th><td>'+json.to_dates.sdate+' ~ '+json.lastdate+'</td></tr>';

        html +='<tr><th class="w130 light dker text-center">룸</th><td>'+json.room_cp+' '+json.room_name+' '+json.room_number+'</td></tr>';
        html += '<tr><th class="w130 light dker text-center">옵션</th><td>' + json.options + '</td></tr>';
        html +='<tr><th class="w130 light dker text-center">결제금액</th><td>'+number_format(json.totalprice)+'원</td></tr>';
        html +='<tr><th class="w130 light dker text-center">입금예정자</th><td>'+json.bankname+'</td></tr>';
        html +='</tbody>';
        html +='</table>';

        if(json.pay_state == 'N'){
            html +='<div class="text-center"><a href="javascript:page_view(\'/admin/realpans/edit?no='+no+'\')" class="btn btn-info btn-sm">예약 상세 보기</a> <a href="javascript:pay_change('+no+',\'Y\')" class="btn btn-dark btn-sm"><i class="fa fa-krw" aria-hidden="true"></i> 입금확인으로 바꾸기</a></div>';
        }else{
            html +='<div class="text-center"><a href="javascript:page_view(\'/admin/realpans/edit?no='+no+'\')" class="btn btn-info btn-sm">예약 상세 보기</a> <a href="javascript:pay_change('+no+',\'Y\')" class="btn  btn-sm"><i class="fa fa-minus-circle" aria-hidden="true"></i> 입금확인전 으로 바꾸기</a></div>';
        }



        html += '</div>';

        bootbox.alert({
            title:'예약정보 확인',
            message:html
        });
        $('.bootbox_modal').css('margin-top','6%');

	},
	error: function(request,status,error) {
		alert(request.responseText);
	}
});


}

function page_view(url){
    //encodeURIComponent()
    $.ajax({
        type: 'GET',
        url: url,

        dataType: 'html',
        success: function(html, status) {
            bootbox.alert({
                message:html,
                size:'large',
            });
            $('.modal-footer ').remove();
            //$('.bootbox_modal').css('margin-top','2%');
        },
        error: function(request,status,error) {
            alert(request.responseText);
        }
    });
}

function pay_change(no,yn) {
    //encodeURIComponent()
    $.ajax({
    type: 'GET',
    url: '/admin/realpans/edit_action?',
    data:'no='+no+'&pay_state='+yn,
    dataType: 'json',
    	success: function(result, status) {
            if(result.error) {
                bootbox.alert(result.messages);
                setTimeout(function() {

                    box.modal('hide');
                }, 3000);
//                        showAlert(result.messages, 'error', 3000);
            } else {
                //showAlert("삭제하였습니다.", 'info', 3000);

                bootbox.hideAll();
                bootbox.alert("변경하였습니다.",function () {
                    bootbox.hideAll();
                    if(strstr(location.hash,"?")){
                        document.location.href=location.hash+"&v="+date("YmdHis");
                    }else{
                        document.location.href=location.hash+"?v="+date("YmdHis");
                    }
                });
            }
    	},
    	error: function(request,status,error) {
    		alert(request.responseText);
    	}
    });
}
</script>