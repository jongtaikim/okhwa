<!DOCTYPE html>
<html lang="ko"  id="ng-app" ng-app class="" >
<head>
  <meta charset="utf-8" />
  <title> [<?=_OID?>] <?=_ONAME?> - 관리자</title>
  <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="/trunk/libs/assets/animate.css/animate.css" type="text/css" />
    <link rel="stylesheet" href="/trunk/libs/assets/font-awesome-4.6.3/css/font-awesome.css" type="text/css" />
  <link rel="stylesheet" href="/trunk/libs/jquery/waves/dist/waves.css" type="text/css" />
  <link rel="stylesheet" href="/trunk/styles/material-design-icons.css" type="text/css" />

  <link rel="stylesheet" href="/trunk/libs/jquery/bootstrap/dist/css/bootstrap.css" type="text/css" />
  <link rel="stylesheet" href="/trunk/styles/font.css" type="text/css" />
  <link rel="stylesheet" href="/trunk/styles/app.css" type="text/css" />
  <link rel="stylesheet" href="./css/board.css" type="text/css" />
  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?1" />
  <script src="/trunk/libs/jquery/jquery/dist/jquery.js"></script>
    <script src="/trunk/scripts/underscore-min.js" type="text/javascript"></script>
    <script src="/trunk/scripts/backbone-min.js" type="text/javascript"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>


</head>
<body>
<div class="pos_f" style="width:100%;z-index:9999999999">
    <div id="alert" class="alert  bg-success  " style="display:none;z-index:9999999999;width:70%;margin:5px auto;border-radius: 0px">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <span class="alert-message"><strong>Warning!</strong> Best check yo self, you're not looking too good.</span>
    </div>
    <div id="alert-error" class="alert alert-error bg-danger " style="display:none;;z-index:9999999999;width:70%;margin:5px auto;;border-radius: 0px">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <span class="alert-message"><strong>Warning!</strong> Best check yo self, you're not looking too good.</span>
    </div>
</div>
<!--공통로드-->
<style type="text/css" title="">
.pop_loading{display:block; text-align:center;padding:25px;;width:100%;height:100%;background-color:rgba(0, 0, 0, 0.26);}
</style>
<div id='pop_loading' class="pop_loading pos_f text-center" style='display:none;top:0;z-index:99999999999999999999'>
	&nbsp;
	<div class="progress" style="margin:-200px auto; width:300px">
	  <div class="progress-bar progress-bar-striped active progress-bar-danger" id="progress" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
	    
	  </div>
	</div>
</div>
<script type="text/javascript">
var ajaxt_y = '';

//로딩
function loading_start(){
	
	$('#pop_loading')	.width($(window).width()).css('padding-top',$(window).height() / 2).show();
	
}

//로딩x
function loading_end(){
	
	$('#pop_loading')	.hide();

}

$( document ).ajaxStart(function() {
 //loading_start();
 ajaxt_y = 'y';
});


$( document ).ajaxComplete(function( event, request, settings ) {
  //loading_end();
  ajaxt_y = '';
});


</script>

<?
$colors = "grey-900";
?>
<div class="app" >
  
  <!-- aside -->
  <aside id="aside" class="app-aside modal fade " role="menu">
    <div class="left">
      <div class="box bg-white">
        <div class="navbar md-whiteframe-z1 no-radius <?=$colors?>">
            <!-- brand -->
            <a class="navbar-brand" href="#adm/admin_main">
             
      
               <span class="hidden-folded m-l inline">
			<img src="./images/logo_hera.png" alt="" style="width:110px;margin-top:10px;margin-left:-6px" />
		   </span>
            </a>
            <!-- / brand -->
        </div>
        <div class="box-row">
          <div class="box-cell scrollable hover" >
            <div class="box-inner">

  

		{#LEFT}              

             
		 </div>
          </div>
        </div>
        
      </div>
    </div>
  </aside>
  <!-- / aside -->          
  


  <!-- content -->
  <div id="content" class="app-content" role="main">
    <div class="box">
          <!-- Content Navbar -->
    <div class="navbar md-whiteframe-z1 no-radius <?=$colors?>">
      <!-- Open side - Naviation on mobile -->
      <a md-ink-ripple  data-toggle="modal" data-target="#aside" class="navbar-item pull-left visible-xs visible-sm" id="top_menu_btn"><i class="mdi-navigation-menu i-24"></i></a>
      <!-- / -->
      <!-- Page title - Bind to $state's title -->
      <div class="navbar-item pull-left h4">
		
		
		<?=_ONAME?> 관리자페이지
	
	</div>
      <!-- / -->
      <!-- Common tools -->
      <ul class="nav nav-sm navbar-tool pull-right">

	   <li>
          <a md-ink-ripple href="/">
            <i class="glyphicon glyphicon-home "></i> 
		홈페이지 바로가기
          </a>
        </li>
        <li>
          <a md-ink-ripple href="/admin/site_adm/logout">
            <i class="mdi-social-person-outline "></i> 
		로그아웃
          </a>
        </li>
      
      </ul>
      <div class="pull-right" ui-view="navbar@"></div>
      <!-- / -->
      <!-- Search form -->
      <div id="search" class="pos-abt w-full h-full <?=$colors?> hide">
        <div class="box">
          <div class="box-col w-56 text-center">
            <!-- hide search form -->
            <a md-ink-ripple class="navbar-item inline"  ui-toggle-class="show" target="#search"><i class="mdi-navigation-arrow-back i-24"></i></a>
          </div>
          <div class="box-col v-m">
            <!-- bind to app.search.content -->
            <input class="form-control input-lg no-bg no-border" placeholder="회원명을 입력해주세요." ng-model="app.search.content">
          </div>
          
        </div>
      </div>
      <!-- / -->
    </div>
    <!-- Content -->

      <div class="box-row">
        <div class="box-cell">
          <div class="box-inner p-t14 ">
            
		<div class=" p-r10" style="overflow-x: auto">
            <div class="content-box" style="min-width:1200px"></div>
		</div>

          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- / content -->

 

    </div>
  </div>

  

    </div>
  </div>


</div>



{#COMMON}

<link rel="stylesheet" type="text/css" href="/trunk/scripts/themes/default/style.css">


<script src="/trunk/libs/jquery/bootstrap/dist/js/bootstrap.js"></script>
<script src="/trunk/libs/jquery/waves/dist/waves.js"></script>

<script src="/trunk/scripts/ui-load.js"></script>
<script src="/trunk/scripts/ui-jp.config.js"></script>
<script src="/trunk/scripts/ui-jp.js"></script>
<script src="/trunk/scripts/ui-nav.js"></script>
<script src="/trunk/scripts/ui-toggle.js"></script>
<script src="/trunk/scripts/ui-form.js"></script>
<script src="/trunk/scripts/ui-waves.js"></script>
<script src="/trunk/scripts/ui-client.js"></script>
<script src="/trunk/scripts/php.js"></script>
<script src="/trunk/scripts/jquery.validate.min.js"></script>
<script src="/trunk/scripts/additional-methods.min.js"></script>
<script src="/trunk/scripts/messages_ko.js"></script>

<script src="/trunk/scripts/parsley.min.ko.js"></script>
<script src="/trunk/scripts/parsley.extend.js"></script> 
<script type="text/javascript" src="/trunk/scripts/jstree.js"></script>	

<script type="text/javascript" src="/trunk/scripts/jquery.url.js"></script>
<script type="text/javascript" src="/trunk/scripts/jquery.cookie.js"></script>
<script type="text/javascript" src="/trunk/scripts/jquery-ui-1.10.4.custom.min.js"></script>
<script type="text/javascript" src="/trunk/scripts/jquery.nicescroll.js"></script>
<script type="text/javascript" src="/trunk/libs/jquery/bootbox/bootbox.js"></script>
<script src="http://dmaps.daum.net/map_js_init/postcode.v2.js"></script>

<script type="text/javascript">
    var multiviewRefreshSeconds = 10;
    var multiviewTimerId;

    var monitorTimerId;
    var lastMonitoringNo = 0;
    var appRouter;
    $(function() {

        var AppRouter = Backbone.Router.extend({
            routes: {
                ":route": "display",
                ":route/": "display",
                ":route/:page": "display",
                ":route/:page/": "display",
                ":route/:page/:seg": "display",
                ":route/:page/:seg/": "display",
                ":route/:page/:seg/:mp": "display",
                ":route/:page/:seg/:mp/": "display",
                ":route/:page/:seg/:mp/:ap": "display",
                ":route/:page/:seg/:mp/:ap/": "display"
            },

            display: function(route, page, seg,mp,ap) {
                var url = route;
                if(page) {
                    url = route + '/' + page;

                    if(seg){
                        url += ('/' + seg);
                    }
                    if(mp){
                        url += ('/' + mp);
                    }
                    if(ap){
                        url += ('/' + ap);
                    }
                }

                loading_start();

                $.ajax({
                    type: 'get',
                    url: url,
                    data: {},
                    dataType: 'html',
                    cache:false,
                    error: function(xhr, e){
                        console.log(e);
                        console.log(xhr);
                    },
                    success: function(html, textStatus, xhr) {
                         $('.content-box').html(html);
                         $('form').each(function () {
                             $(this).unbind('submit').submit(function () {
                                 var action;
                                 var tfrom = $(this);


                                 if($(this).attr('action')) action = $(this).attr('action'); else action = url;


                                 $.ajax({
                                     type: 'post',
                                     url: action,
                                     data: $(this).serialize(),
                                     dataType:"json",
                                     error: function(xhr, e){
                                         alert(' 페이지에 접속할 수 없습니다.', 'error', 3000);
                                         console.log(xhr.responseText);
                                     },
                                     success: function(result) {
                                         alert(result.message);
                                         if(result.code =="200"){
                                             $('form').each(function(){

                                                     location.href=location.hash+'&v='+date("YmdHis");

                                             });
                                         }

                                     }
                                 });

                             return false;
                             });
                         });
                     },
                    complete: function(xhr, textStatus) {
                        loading_end();

                        if($('#aside').hasClass('in')) $('#top_menu_btn').trigger('click');
                    }
                });
                //endLoading(); // 한번 더 호출
            }
        });

        appRouter = new AppRouter();
        Backbone.history.start();

        // route가 변경될 때마다
        appRouter.bind("all",function(route, router) {
            clearInterval(monitorTimerId);
            clearInterval(multiviewTimerId);
        });
    });

    function form_submit(name,action) {

        if(!action) {
            action = $('form[name='+name+']').attr('action');
        }
        $.ajax({
            type: 'post',
            url: action,
            data: $('form[name='+name+']').serialize(),
            cache:false,
            dataType:"json",
            error: function(xhr, e){
                showAlert(word+' 페이지에 접속할 수 없습니다.', 'error', 3000);
                console.log(xhr.responseText);
            },
            success: function(result) {
                alert(result.message);

            }
        });
    }

    $(document).ready(function(){
       if(!location.hash){
           location.href='#adm/admin_main';
       }
    });

    var showAlert = function(message, level, duration) {
        message = message || '';
        level = level || 'info';
        duration = duration || 0;

        var doc = '#alert';
        if(level=='error') {
            doc = '#alert-error';
        }
        var obj = $(doc);
        $(doc + ' .alert-message').html(message);

        $("html, body").animate({ scrollTop: 0 }, "fast", function() {
            obj.slideDown();

            if(duration > 0) {
                $notifyTimer = setTimeout(function () {
                    obj.slideUp();
                }, duration);
            }
        });
    };



    var jsondata ='';
    function view_reserve(no,pay_state) {
//encodeURIComponent()
        $.ajax({
            type: 'GET',
            url: '/admin/realpans/data_json?no='+no,
            data:'',
            cache:false,
            dataType: 'json',
            success: function(data, status) {
                console.log(data);
                json = data.result;
                var html = '<div>';

                html +='<table align="center" width="100%" border="0" cellspacing="0" cellpadding="0" class="table table-bordered cumr" style="font-size:14px">';
                html +='<tbody>';
                html +='<tr><th class="w130 light dker text-center " >예약자</th><td class="padding">'+json.name+'</td></tr>';
                html +='<tr><th class="w130 light dker text-center " >전화번호</th><td class="padding">'+substr(json.phone,0,3)+'-'+substr(json.phone,3,4)+'-'+substr(json.phone,7,4)+'</td></tr>';
                html +='<tr><th class="w130 light dker text-center">예약일시</th><td>'+json.created+'</td></tr>';
                html +='<tr><th class="w130 light dker text-center">날짜</th><td>'+json.to_dates.sdate+' ~ '+json.lastdate+'</td></tr>';

                html +='<tr><th class="w130 light dker text-center">룸</th><td>'+json.room_cp+' '+json.room_name+' '+json.room_number+'</td></tr>';
                if(json.options) {
                    html += '<tr><th class="w130 light dker text-center">옵션</th><td>' + json.options + '</td></tr>';
                }
                html +='<tr><th class="w130 light dker text-center">결제금액</th><td>'+number_format(json.totalprice)+'원</td></tr>';
                html +='<tr><th class="w130 light dker text-center">입금예정자</th><td>'+json.bankname+'</td></tr>';
                if(json.pay_state == 'Y'){
                    html +='<tr><th class="w130 light dker text-center">입금확인</th><td style="color:blue">입금확인됨</td></tr>';
                }else{
                    html +='<tr><th class="w130 light dker text-center">입금확인</th><td style="color:red">입금대기</td></tr>';
                }

                html +='</tbody>';
                html +='</table>';

                if(json.pay_state == 'N'){
                    html +='<div class="text-center"><a href="javascript:page_view(\'/admin/realpans/edit?no='+no+'\')" class="btn btn-info btn-sm">예약 상세 보기</a> <a href="javascript:pay_change(\''+json.code+'\',\'Y\',\''+json.name+'\',\''+json.phone+'\')" class="btn btn-dark btn-sm"><i class="fa fa-krw" aria-hidden="true"></i> 입금확인으로 바꾸기</a> <a href="javascript:pay_del(\''+json.code+'\')" class="btn red btn-sm"><i class="fa fa-times" aria-hidden="true"></i> 취소하기</a></div>';
                }else{
                    html +='<div class="text-center"><a href="javascript:page_view(\'/admin/realpans/edit?no='+no+'\')" class="btn btn-info btn-sm">예약 상세 보기</a> <a href="javascript:pay_change(\''+json.code+'\',\'N\',\''+json.name+'\',\''+json.phone+'\')" class="btn  btn-sm"><i class="fa fa-minus-circle" aria-hidden="true"></i> 입금확인전 으로 바꾸기</a></div>';
                }

                html += '</div>';

                bootbox.alert({
                    title:'예약정보 확인',
                    message:html
                });
                $('.bootbox_modal').css('margin-top','6%');

            },
            error: function(request,status,error) {
                alert(request.responseText);
            }
        });


    }
    function pay_change(no,yn,name,phone) {
        if (confirm("상태를 변경하시겠습니까?") == true) {
        $.ajax({
            type: 'POST',
            url: '/admin/realpans/edit_action_pay_state?',
            data:'code='+no+'&pay_state='+yn+'&name='+name+'&phone='+phone,
            dataType: 'json',
            cache:false,
            success: function(result, status) {
                if(result.error) {
                    bootbox.alert(result.messages);
                    setTimeout(function() {

                        box.modal('hide');
                    }, 3000);
//                        showAlert(result.messages, 'error', 3000);
                } else {
                    //showAlert("삭제하였습니다.", 'info', 3000);

                    bootbox.hideAll();
                    bootbox.alert("변경하였습니다.",function () {
                        bootbox.hideAll();
                        if(strstr(location.hash,"?")){
                            document.location.href=location.hash+"&v="+date("YmdHis");
                        }else{
                            document.location.href=location.hash+"?v="+date("YmdHis");
                        }
                    });
                }
            },
            error: function(request,status,error) {
                alert(request.responseText);
            }
        });
        }
    }
    function pay_del(no) {
        if (confirm("정말 취소하시겠습니까??(복구불능)") == true) {
            $.ajax({
                type: 'POST',
                url: '/admin/realpans/delete_pe',
                data: 'code=' + no,
                dataType: 'json',
                cache:false,
                success: function (result, status) {
                    if (result.error) {
                        bootbox.alert(result.messages);
                        setTimeout(function () {

                            box.modal('hide');
                        }, 3000);
//                        showAlert(result.messages, 'error', 3000);
                    } else {
                        //showAlert("삭제하였습니다.", 'info', 3000);

                        bootbox.hideAll();
                        bootbox.alert("취소하였습니다.", function () {
                            bootbox.hideAll();
                            if (strstr(location.hash, "?")) {
                                document.location.href = location.hash + "&v=" + date("YmdHis");
                            } else {
                                document.location.href = location.hash + "?v=" + date("YmdHis");
                            }
                        });
                    }
                },
                error: function (request, status, error) {
                    alert(request.responseText);
                }
            });
        }
    }

    $(document).ready(function(){
       if($(window).width() <600){
           $('.content-box').css('zoom','0.5');
       }else{
           $('.content-box').css('zoom','1');
       }
    });
</script>

</body>
</html>
